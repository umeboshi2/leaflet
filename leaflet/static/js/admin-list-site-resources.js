// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var ctype, delete_resource, destroy_entry, main_id;
    $('.delete-confirm').hide();
    main_id = $('#main_id').val();
    ctype = $('#ctype').val();
    destroy_entry = function(data, status, xhr) {
      var entry_id, f, msg;
      f = $.parseJSON(data);
      entry_id = 'entry-' + f.ctype + '-' + f.id;
      if (f.update === 'deleted') {
        $('#' + entry_id).empty();
        return $('#' + entry_id).remove();
      } else {
        $('#' + entry_id).empty();
        msg = "There are pages using this resource.";
        return $('#' + entry_id).text(msg);
      }
    };
    delete_resource = function(ctype, id) {
      var entry_id, formdata;
      entry_id = 'entry-' + ctype + '-' + id;
      formdata = {
        update: 'delete',
        ctype: ctype,
        id: id
      };
      return $.post(window.location, formdata, destroy_entry);
    };
    $('.delete-button').click(function() {
      var btnid, div_id;
      $(this).hide();
      btnid = $(this).attr('id').split('-')[2];
      div_id = 'div-confirm-' + ctype + '-' + btnid;
      return $('#' + div_id).show();
    });
    $('.cancel-button').click(function() {
      var btnid, del_id, div_id;
      btnid = $(this).attr('id').split('-')[2];
      div_id = 'div-confirm-' + ctype + '-' + btnid;
      $('#' + div_id).hide();
      del_id = 'delete-' + ctype + '-' + btnid;
      return $('#' + del_id).show();
    });
    $('.confirm-button').click(function() {
      var btnid;
      btnid = $(this).attr('id').split('-')[2];
      return delete_resource(ctype, btnid);
    });
    return $('#save-content').click(function() {
      var formdata;
      $('header > h2').text(window.location);
      formdata = {
        update: "submit",
        content: editor.getValue()
      };
      post_to_url(window.location, formdata, 'post');
      return $('header > h2').text("Posted");
    });
  });

}).call(this);
